<!DOCTYPE html>
<html lang="zh-Hans">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" href="./assets/image/favicon.png" type="image/x-icon">
  <link rel="stylesheet" href="./style/index.css">
  <title>窗台</title>
</head>

<body>

  <span id="notexist" style="display: none;"></span>
  <canvas id="background">
    <p>您的浏览器不支持 Canvas 画布, 请考虑使用 Chrome 最新版.</p>
  </canvas>
  <div id="dialog-area"></div>
  <div id="toolbox" class="show">
    <div class="button box" onclick="APP.scrollTo({x: 0, y: 0, z: 0})">回到顶部</div>
    <div class="button box" onclick="app.refresh()">换一换</div>
    <div class="button box" onclick="APP.scrollTo({x: 0, y: document.body.offsetHeight, z: 0})">前往底部</div>
  </div>

  <header>
    <h1 id="page-title" class="title">窗台</h1>
    <p id="header-motto"></p>
    <nav>
      <a id="link-home" class="button" data-router="home">首页</a>
      <a id="link-article" class="button" data-router="article">文字</a>
      <a id="link-image" class="button" data-router="image">时刻</a>
      <a id="link-song" class="button" data-router="song">声音</a>
      <a id="link-about" class="button" data-router="about">关于</a>
    </nav>
  </header>

  <section id="content-home" class="content">
    <!-- <img src="./assets/image/index.jpg" alt="Home" width="100%"> -->
    <p style="font-size: 3rem; font-weight: bold;" onmouseover="Home.toggleArticle()">大道虽简，知易行难。</p>
    <article id="article-home">
      <p>瀑布的水逆流而上</p>
      <p>蒲公英种子从远处飘回 聚成伞的模样</p>
      <p>太阳从西边升起 落向东方</p>
      <p>子弹退回枪膛</p>
      <p>运动员回到起跑线上</p>
      <p>我交回录取通知书 忘了十年寒窗</p>
      <p>厨房里飘来饭菜的香</p>
      <p>你把我的卷子签好名字</p>
      <p>关掉电视 帮我把书包背上</p>
      <p>你还在我身旁</p>
      <br>
      <h2 class="author">
        <i>你还在我身旁</i> 戴畅
      </h2>
    </article>
  </section>

  <section id="content-article" class="content">
    <div class="loading init">
      <h2>正在加载文字, 请稍后...</h2>
    </div>
  </section>

  <section id="content-image" class="content">
    <div class="loading init">
      <h2>正在加载时刻, 请稍后...</h2>
    </div>
  </section>

  <section id="content-song" class="content">
    <div class="card player init" data-mid="0">
      <div class="info">
        <div class="text">
          <h2 class="title">歌曲</h2>
          <h3 class="artist">歌手</h3>
          <p class="album">专辑</p>
          <!-- <article class="lyrics">
            <p>暂无歌词.</p>
          </article> -->
        </div>
        <img class="album" src="./assets/image/cd.png" alt="CD 封面">
      </div>
      <div class="controller">
        <button class="previous" onclick="player.playPrev()"></button>
        <button class="toggle pause" onclick="Song.play()"></button>
        <button class="next" onclick="player.playNext()"></button>
      </div>
    </div>
    <div class="loading init">
      <h2>正在加载歌曲列表, 请稍后...</h2>
    </div>
  </section>

  <section id="content-about" class="content">
    <article id="atricle-about">
      <h2 class="title">大学 生活</h2>
      <p>几年前踏上火车那一刻，我都还没有意识到。</p>
      <p>从此故乡只有冬夏，再无春秋。</p>
    </article>
  </section>

  <footer>
    <p>
      <b>2018 版权所有 <a href="https://github.com/DevinDon">夜寒苏</a></b>
    </p>
  </footer>

</body>

<script src="./script/lib/anime.min.js"></script>
<script src="./script/lib/axios.min.js"></script>
<script src="./script/lib/jquery.min.js"></script>
<script src="./script/lib/player.min.js"></script>
<script src="./script/index.js"></script>
<script>

  let app;
  let player;

  window.onload = () => {
    app = new APP('blog');
    player = new QMplayer();
    player.on('play', e => {
      Song.toggle();
      // console.log('play');
    });
    player.on('pause', e => {
      Song.toggle();
      // console.log('pause');
    });
    player.on('ended', e => {
      Song.toggle();
      // console.log('ended');
    });
    player.on('waiting', e => {
      Song.toggle();
      // console.log('waiting');
    });
    player.on('error', e => {
      Song.toggle();
      // console.log('error');
    });
  }

  const Home = {
    toggleArticle: () => {
      const $art = $('#article-home');
      if ($art.hasClass('busy')) {
        return false;
      }
      $art.addClass('busy');
      if ($art.hasClass('show')) {
        // 隐藏
        anime({
          targets: $art.get(0),
          duration: 1500,
          height: [475.81, 0],
          opacity: [1, 0],
          easing: 'easeInOutCirc',
          complete: () => $art.removeClass('show').removeClass('busy')
        });
      } else {
        // 展开
        anime({
          targets: $art.get(0),
          duration: 1500,
          height: [0, 475.81],
          opacity: [0, 1],
          easing: 'easeInOutCirc',
          complete: () => $art.addClass('show').removeClass('busy')
        });
      }
    }
  };

  const Song = {
    $player: $('#content-song>.player'),
    controller: {
      toggle: $('#content-song>.player>.controller>.toggle')
    },
    albumAnimation: anime({
      targets: $('#content-song .info img').get(0),
      rotate: 360,
      duration: 12 * 1000,
      easing: [0, 0, 0, 0],
      autoplay: false,
      loop: true
    }),
    toggle: () => {
      if (player.state === 'playing') {
        Song.albumAnimation.play();
        Song.controller.toggle.removeClass('pause');
        Song.controller.toggle.addClass('play');
      } else {
        Song.albumAnimation.pause();
        Song.controller.toggle.removeClass('play');
        Song.controller.toggle.addClass('pause');
      }
    },
    play: id => {
      if (id) {
        player.play(id);
        Song.$player.attr('data-mid', id);
      } else if (player.data.song) {
        player.toggle();
        Song.toggle();
      } else {
        player.play(Song.$player.attr('data-mid'));
      }
    }
  };

</script>

</html>
